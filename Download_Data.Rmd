---
title: "Download Guide Environmental Data to Sea Urchin"
subtitle: "Suplementary analysis to Stock Assessment Sea Urchin 2024"
author: "Mauricio Mardones"
date:  "`r format(Sys.time(), '%d %B, %Y')`"
bibliography: env_seaurchin.bib
csl: apa.csl
link-citations: yes
linkcolor: blue
output:
  pdf_document:
    toc: true
---
\pagebreak

## CONTEXT

Copernicus Marine data are available to download through server access services, all with the possibility of being integrated into scripts.
 
One of the most used endpoint is the MOTU API, by integrating the Python motuclient command line in a complete and operative script, regardless of the code language.
 
Indeed, motuclient is a cross-platform package that enables to download data by running a Python script. It can be integrated as a simple command line of your system from the language of your choice. 

Another method is to use the `CopernicusMarine` package developed to facilitate the retrieval of data from the Copernicus Marine catalog.
 
Let's see in this article an example of script to run a download process and how to use the `CopernicusMarine` package in R [@Good2020].

This data is download to do correlatrion analysis to get anothor factor to add in standarization in CPUE for sea urchin in Sourthern Chile fishery.

\pagebreak
## SETUP

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Set libraries and Install first MOTU client

```{r eval=FALSE}
system("pip install motuclient==1.8.4")
#install.packages("CopernicusMarine")
```

```{r }
library(CopernicusMarine)
library(here)
```

Set credentials in Copernicus Data. 

```{r echo=FALSE}
CopernicusMarine_uid = "mmardones"           #ID
CopernicusMarine_pwd = "Trekkero_1"
```

Set dir data sink
Data folder is
```{r}
dir1 <- here("Data")
```

Define geo-frame to get data

We set limiit from X y XI region in Southern Chile

```{r echo=T, eval=T}
zona <- c(-81,-58,-70,-28)
```
Data available in the main repo from [Copernicus](https://data.marine.copernicus.eu/products)


The OSTIA [@Good2020] global sea surface temperature reprocessed product provides daily gap-free maps of foundation sea surface temperature and ice concentration (referred to as an L4 product) at 0.05deg.x 0.05deg. horizontal grid resolution, using in-situ and satellite data. This product provides the foundation Sea Surface Temperature, which is the temperature free of diurnal variability.

Then, select source data to analysis and put that name in the next line;


One of the variables to be analyzed and correlated with the biological data of the southern sea urchin will be chlorophyll, since this resource is a nutrient filter from the water mass. While there isn't a direct relationship, it is a test that must be done.

```{r}
list1<-copernicus_products_list(freeText = "GLOBAL_ANALYSIS_FORECAST_BIO_001_028")  
detail1<-copernicus_product_details("GLOBAL_ANALYSIS_FORECAST_BIO_001_02")
```

Details for selecting subvariables 

```{r}
list1$mainVariables
list1$numLayers
detail1$layers$`cmems_mod_glo_bgc_my_0.25_P1D-m/chl`$variableTitle

```

Download `Mass concentration of chloropyll a in sea water`  data;

```{r eval=FALSE}
# Set parameters to subset and run the download 
copernicus_download_motu(
  username = CopernicusMarine_uid,
  password = CopernicusMarine_pwd,
  destination = dir1,
  product = "GLOBAL_ANALYSIS_FORECAST_BIO_001_028" ,
  layer = "global-analysis-forecast-bio-001-028-monthly",
  variable = "Mass concentration of chloropyll a in sea water",
  output = "netcdf",
  region  = zona,
  timerange = c("2000-01-01 12:00:00","2023-03-30 12:00:00"),
  sub_variables = c("chl"),
  verticalrange = c(0, 100)
)
```



```{r eval=FALSE}
copernicus_download_motu(
  username = CopernicusMarine_uid,
  password = CopernicusMarine_pwd,
  destination = dir1,
  product = "GLOBAL_ANALYSIS_FORECAST_BIO_001_028" ,
  layer = "global-analysis-forecast-bio-001-028-monthly",
  variable = "Mass concentration of chloropyll a in sea water",
  output = "netcdf",
  region = zona,
  timerange = c("2010-01-01 12:00:00","2023-03-30 12:00:00"),
  sub_variables = c("chl"),
  verticalrange = c(0, 100)
)
```
\pagebreak
# REFERENCES

