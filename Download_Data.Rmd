---
title: "Download_Env_Data"
author: "Mauricio Mardones I."
date: "2023-08-25"
output: pdf_document
---
## CONTEXT

Copernicus Marine data are available to download through server access services, all with the possibility of being integrated into scripts.
 
One of the most used endpoint is the MOTU API, by integrating the Python motuclient command line in a complete and operative script, regardless of the code language.
 
Indeed, motuclient is a cross-platform package that enables to download data by running a Python script. It can be integrated as a simple command line of your system from the language of your choice. 

Another method is to use the `CopernicusMarine` package developed to facilitate the retrieval of data from the Copernicus Marine catalog.
 
Let's see in this article an example of script to run a download process and how to use the `CopernicusMarine` package in R. 
 
## SETUP

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
Set libraries and Install first MOUT client

```{r eval=FALSE}
#system("pip install motuclient==1.8.4")
install.packages("CopernicusMarine")
library(CopernicusMarine)
library(here)
```

Set credentials in Copernicus Data. 

```{r echo=FALSE}
CopernicusMarine_uid = "mmardones"           #ID
CopernicusMarine_pwd = "Trekkero_1"  #password
```

Set dir data sink

```{r}
dir1 <- here("Data")
```


Define geo-frame to get data

We set limiit from X y XI region in Southern Chile

```{r echo=T, eval=T}
zona <- c(-75,-72,-46,-41)
```
Data available in the main repo from [Copernicus](https://data.marine.copernicus.eu/products)


The OSTIA [@Good2020] global sea surface temperature reprocessed product provides daily gap-free maps of foundation sea surface temperature and ice concentration (referred to as an L4 product) at 0.05deg.x 0.05deg. horizontal grid resolution, using in-situ and satellite data. This product provides the foundation Sea Surface Temperature, which is the temperature free of diurnal variability.

Then, select source data to analysis and put that name in the next line;

```{r}
list1<-copernicus_products_list(freeText = "SST_GLO_SST_L4_REP_OBSERVATIONS_010_011")  
detail1<-copernicus_product_details("SST_GLO_SST_L4_REP_OBSERVATIONS_010_011")
```

Details for selecting subvariables 

```{r}
list1$mainVariables
list1$numLayers
detail1$layers$`METOFFICE-GLO-SST-L4-REP-OBS-SST/analysed_sst`$variableTitle
```

```{r}
copernicus_download_motu(
  username = CopernicusMarine_uid,
  password = CopernicusMarine_pwd,
  destination = dir1,
  product = "SST_GLO_SST_L4_REP_OBSERVATIONS_010_011" ,
  layer = "METOFFICE-GLO-SST-L4-REP-OBS-SST/analysed_sst", # "Mass concentration of chlorophyll a in sea water"
  variable = "Sea surface foundation temperature",
  output = "netcdf",
  region = zona, # vertices from giant petrel data
  timerange = c("1993-01-01 12:00:00","2010-03-30 12:00:00"),
  sub_variables = "analysed_sst",
  verticalrange = c(0, 50)
)
```

```{r}
# sea ice
copernicus_download_motu(
  username = CopernicusMarine_uid,
  password = CopernicusMarine_pwd,
  destination = dir1,
  product = "GLOBAL_MULTIYEAR_PHY_001_030" ,
  layer = "cmems_mod_glo_phy_my_0.083_P1M-m",
  variable = "Sea ice",
  output = "netcdf",
  region = zona, # (xmin,ymin,xmax,ymax)
  timerange = c("2005-01-01 12:00:00","2020-12-31 12:00:00"),
  sub_variables = c("siconc"),
  verticalrange = c(0, 50)
)
```

